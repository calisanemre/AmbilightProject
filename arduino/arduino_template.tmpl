#include <Arduino.h>
#include <FastLED.h>

#define LED_PIN     {{LED_PIN}}
#define NUM_LEDS    {{NUM_LEDS}}
#define BAUD_RATE   {{BAUD_RATE}}

CRGB leds[NUM_LEDS];
uint8_t data[NUM_LEDS * 3];

void setup() {
  Serial.begin(BAUD_RATE);
  FastLED.addLeds<WS2812, LED_PIN, GRB>(leds, NUM_LEDS);
  FastLED.clear();
  FastLED.show();
  Serial.setTimeout(50);
}

void loop() {
  if (Serial.available() > 0 && Serial.peek() == 'b') {
    Serial.read(); // 'b' karakterini atla
    int level = Serial.parseInt(); // sayıyı oku
    level = constrain(level, 0, 255);
    FastLED.setBrightness(level);
    FastLED.show();
  }
  
  if (Serial.available() >= NUM_LEDS * 3) {
    Serial.readBytes(data, NUM_LEDS * 3);
    for (int i = 0; i < NUM_LEDS; i++) {
      leds[i] = CRGB(data[i * 3], data[i * 3 + 1], data[i * 3 + 2]);
    }
    FastLED.show();
  }
}
